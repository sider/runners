#!/usr/bin/env ruby

require "pathname"

$LOAD_PATH << Pathname(__dir__).parent + "lib"

require "bugsnag"
require "timeout"
require "runners"
require "runners/cli"

Bugsnag.configure do |config|
  config.app_version = ENV["RUNNERS_VERSION"]
end

at_exit do
  if $!
    Bugsnag.notify($!)
  end
end

pid = fork do
  Runners::CLI.new(argv: ARGV, stdout: STDOUT, stderr: STDERR).validate_options!.run
end

Timeout.timeout(ENV['RUNNERS_TIMEOUT'] || 1_800) do
  Process.waitpid(pid)
end
